language: php

php:
  - 5.4
  - 5.5
  - 5.6
  - hhvm

matrix:
  allow_failures:
    - php: hhvm
  fast_finish: true

services: 
  - mysql

mysql:
  database: wp_bebop
  username: root
  encoding: utf8

env:
  global:
  matrix:
    - WORDPRESS_VERSION=3.5.2
    - WORDPRESS_VERSION=3.9

before_install:

  # Update testing machine
  - sudo apt-get update -qq
  - sudo apt-get install -qq

  # Install Java and PhantomJS
  - sudo apt-get install -y default-jre phantomjs
  - java -version
  - phantomjs -v

  # Install and run Selenium WebDriver
  - wget http://selenium-release.storage.googleapis.com/2.41/selenium-server-standalone-2.41.0.jar
  - java -jar selenium-server-standalone-2.41.0.jar &

  # Start built-in PHP server (PHP >= 5.4)
  - mkdir wp-core
  - php -S localhost:8000 -t ./wp-core &

install: composer install -o --no-interaction

before_script:

  # Create database
  - mysql -e 'create database wp_bebop'

  # Install WordPress
  - source ./ci/install-wordpress.sh $WORDPRESS_VERSION

  # Setup testing theme
  - source ./ci/setup-theme.sh

script: ./vendor/bin/codecept run